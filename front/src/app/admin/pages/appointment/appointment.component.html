<app-nav></app-nav>

<main style="margin-left: 320px; margin-right: 20px;">
  <h1 style="padding-top: 20px;">Lista de Citas</h1>

  <button class="btn btn-primary mb-3" (click)="showAddAppointmentForm()">Agregar Cita</button>

  <div *ngIf="showAddForm" class="mt-4 mb-5">
    
    <div class="card">
      <div class="card-header bg-dark text-white">
        <h3 class="mb-0">{{ selectedAppointment ? 'Editar Cita' : 'Agregar Cita' }}</h3>
      </div>
      
      <div class="card-body">
        <form [formGroup]="appointmentForm" (ngSubmit)="saveAppointment()">
          
          <div class="mb-3" *ngIf="!selectedAppointment">
            <label class="form-label">Id Usuario:</label>
            <input type="number" formControlName="userId" class="form-control" placeholder="Ej: 1" />
            <small class="text-danger" *ngIf="appointmentForm.get('userId')?.touched && appointmentForm.get('userId')?.invalid">
              El ID de usuario es obligatorio.
            </small>
          </div>

          <div class="mb-3" *ngIf="!selectedAppointment">
            <label class="form-label">Id Servicio:</label>
            <input type="number" formControlName="serviceId" class="form-control" placeholder="Ej: 2" />
          </div>

          <div class="mb-3" *ngIf="!selectedAppointment">
            <label class="form-label">Id Mascota:</label>
            <input type="number" formControlName="petId" class="form-control" placeholder="Ej: 5" />
          </div>

          <div class="mb-3">
            <label class="form-label">Fecha:</label>
            <input formControlName="appointmentDate" class="form-control" type="date" />
          </div>

          <div class="mb-3">
            <label class="form-label">Hora inicio:</label>
            <input formControlName="startTime" class="form-control" type="time" />
          </div>

          <div class="mb-3">
            <label class="form-label">Hora fin:</label>
            <input formControlName="endTime" class="form-control" type="time" />
          </div>

          <div class="mb-3">
            <label class="form-label">Estado:</label>
            <select formControlName="status" class="form-control">
              <option value="PENDIENTE">PENDIENTE</option>
              <option value="CONFIRMADA">CONFIRMADA</option>
              <option value="CANCELADA">CANCELADA</option>
              <option value="FINALIZADA">FINALIZADA</option>
            </select>
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success">
              {{ selectedAppointment ? 'Actualizar' : 'Guardar' }}
            </button>
            <button type="button" (click)="cancel()" class="btn btn-secondary">
              Cancelar
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
  
  <table class="table table-striped table-bordered mt-4">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>ID Usuario</th>
        <th>ID Servicio</th>
        <th>ID Mascota</th>
        <th>Fecha</th>
        <th>Hora inicio</th>
        <th>Hora fin</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let appointment of appointments">
        <td>{{ appointment.id }}</td>
        <td>{{ appointment.user?.id || 'N/A' }}</td>
        <td>{{ appointment.service?.id || 'N/A' }}</td>
        <td>{{ appointment.pet?.id || 'N/A' }}</td>
        <td>{{ appointment.appointmentDate }}</td>
        <td>{{ appointment.startTime }}</td>
        <td>{{ appointment.endTime }}</td>
        <td>
           <span [ngClass]="{
            'badge bg-warning': appointment.status === 'PENDIENTE',
            'badge bg-success': appointment.status === 'CONFIRMADA',
            'badge bg-danger': appointment.status === 'CANCELADA'
          }">
            {{ appointment.status }}
          </span>
        </td>
        <td>
          <button class="btn btn-warning btn-sm" (click)="editAppointment(appointment)" style="margin-right: 5px;">
            <i class="fas fa-edit"></i> Editar
          </button>
          <button class="btn btn-danger btn-sm" (click)="deleteAppointment(appointment.id)">
            <i class="fas fa-trash"></i> Eliminar
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</main>
